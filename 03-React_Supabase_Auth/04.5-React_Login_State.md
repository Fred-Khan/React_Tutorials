
## ğŸ§© Part 4.5 â€“ Making the Navbar Aware of Login State + Adding Logout

### ğŸ¯ Learning Goals

âœ… Detect when a user is logged in using Supabase Auth
âœ… Show **Login** when logged out, but **Logout + Dashboard** when logged in
âœ… Trigger Supabaseâ€™s `signOut()` function and redirect the user
âœ… Understand what `onAuthStateChange()` does and why it matters
âœ… Understand the difference between **UI-based access** and **Protected Routes**

---

## ğŸ›  Step 1 â€“ Update `Navbar.tsx`

ğŸ“Œ This version **listens for login/logout events**, stores the **auth state** in React, and shows the correct links in the navigation bar.

Update Navbar.tsx

```tsx
import { NavLink, useNavigate } from "react-router-dom";
import { useEffect, useState } from "react";
import { supabase } from "../supabaseClient";

export default function Navbar() {
  // Tracks whether a user is logged in
  const [isLoggedIn, setIsLoggedIn] = useState(false);

  const navigate = useNavigate();

  // Check login state on page load + listen for auth changes
  useEffect(() => {
    // 1. Check current session (page refresh, direct visit, etc.)
    supabase.auth.getSession().then(({ data: { session } }) => {
      setIsLoggedIn(!!session); // true if logged in, false if not
    });

    // 2. Listen for login/logout events in real time
    const { data: listener } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setIsLoggedIn(!!session);
      }
    );

    // Cleanup the listener on unmount
    return () => listener.subscription.unsubscribe();
  }, []);

  // Logout function
  const handleLogout = async () => {
    await supabase.auth.signOut();
    navigate("/"); // redirect to home page after logout
  };

  return (
    <nav className="navbar">
      <div className="container">
        <NavLink to="/" className="logo">MyWebsite</NavLink>
        <ul className="nav-links">

          <li><NavLink to="/">Home</NavLink></li>
          <li><NavLink to="/about">About</NavLink></li>

          {/* If logged out â†’ show Login link */}
          {!isLoggedIn && (
            <li><NavLink to="/login">Login</NavLink></li>
          )}

          {/* If logged in â†’ show Dashboard + Logout */}
          {isLoggedIn && (
            <>
              <li><NavLink to="/dashboard">Dashboard</NavLink></li>
              <li><button onClick={handleLogout} className="logout-btn">Logout</button></li>
            </>
          )}

        </ul>
      </div>
    </nav>
  );
}
```

---

### ğŸ§  Code Breakdown

| Code Section                 | What It Does                                                        |
| ---------------------------- | ------------------------------------------------------------------- |
| `useState(false)`            | Starts assuming user is **not logged in**                           |
| `supabase.auth.getSession()` | Checks whether user already has a valid session (e.g. page refresh) |
| `onAuthStateChange()`        | Reacts instantly if login/logout happens anywhere in app            |
| `!!session`                  | Converts session object to `true`/`false`                           |
| `handleLogout()`             | Calls Supabase to clear auth token, then redirects                  |
| Conditional JSX              | Shows different menu items depending on login state                 |

---

## âœ… Add CSS for Logout Button (Optional)

Add this at bottom of **App.css** so the Logout button matches the nav links:

```css
/* Logout link styled like <a> elements */
.logout-btn {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 1rem;
}

.logout-btn:hover {
  color: #FFD700;
}
```

---

## ğŸ“Œ Optional Redirect Variant

Current behaviour after logout is to redirect to **Home page**:

```ts
navigate("/");
```

If you want to redirect to **Login page instead**, change it to:

```ts
navigate("/login");
```

âœ… This shows how UX choices change routing behaviour.

---

## ![Alert](./assets/Police_Flashing_Lights_10.gif) Important Clarification ![Alert](./assets/Police_Flashing_Lights_10.gif)

### ğŸš« â€œShowing/Removing Linksâ€ is **NOT** Security

Right now:

* A logged-out user **cannot see** the Dashboard link :white_check_mark:
* But they *can still type* `/dashboard` manually in the browser :x:
* There is **no protection yet** â€” only UI hiding :warning:

ğŸ‘€ **In Part 5 Protected Routes** is when we prevent access **even if someone manually types the URL**.

> **Front-end visibility â‰  Security.**

> **Authentication + Route Guards + RLS = Real Protection.**

---

## ğŸ§ª Testing Checklist

| Test                                           | Expected Result                                              |
| ---------------------------------------------- | ------------------------------------------------------------ |
| Visit site logged out                          | Navbar shows **Home / About / Login**                        |
| Login with Supabase user                       | Navbar immediately changes, now shows **Dashboard + Logout** |
| Click Logout                                   | User is signed out, redirected to `/login`                   |
| Refresh page while logged in                   | Navbar still shows Dashboard + Logout                        |
| Refresh after logout                           | Navbar resets to Login state                                 |
| Type `/dashboard` manually (currently allowed) | âœ… Works for now â€” will be locked in Part 5                   |

---

## :fast_forward: Next Step

**Part 5 â€“ Protected Routes + Supabase Row Level Security (RLS)**
ğŸ”’ Prevent access when user is not logged in
ğŸ”’ Only `is_admin = true` users can manage other users
ğŸ” Add actual Supabase RLS policies

---

[Back](04-Login_Using_Supabase_Auth.md) -- [Next](05-Protected_Routes_and_Supabase_RLS.md)