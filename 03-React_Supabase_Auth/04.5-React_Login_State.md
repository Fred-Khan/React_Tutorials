
## :jigsaw: Part 4.5 – Making the Navbar Aware of Login State + Adding Logout

### :dart: Learning Goals

:white_check_mark: Detect when a user is logged in using Supabase Auth <br/>
:white_check_mark: Show **Login** when logged out, but **Logout** and **Dashboard** when logged in <br/>
:white_check_mark: Trigger Supabase’s `signOut()` function and redirect the user <br/>
:white_check_mark: Understand what `onAuthStateChange()` does and why it matters <br/>
:white_check_mark: Understand the difference between **UI-based access** and **Protected Routes** <br/>

---

## :hammer_and_wrench: 1. Update `Navbar.tsx`

:pushpin: This version **listens for login/logout events**, stores the **auth state** in React, and shows the correct links in the navigation bar.

- Update **`Navbar.tsx`**

```tsx
// Import navigation tools from react-router-dom
// NavLink = clickable navigation links
// useNavigate = lets us redirect users programmatically
import { NavLink, useNavigate } from "react-router-dom";

// Import React hooks
// useState = store and update values (like login status)
// useEffect = run code when component loads or updates
import { useEffect, useState } from "react";

// Import supabase client (handles authentication)
import { supabase } from "../supabaseClient";

// Define the Navbar component
export default function Navbar() {
  // Create a state variable to track if user is logged in
  // isLoggedIn = true/false
  // setIsLoggedIn = function to update the value
  const [isLoggedIn, setIsLoggedIn] = useState(false);

  // Create a navigate function to redirect users
  const navigate = useNavigate();

  // useEffect runs when the component first loads
  // Here we check login status and listen for changes
  useEffect(() => {
    // 1. Check current session (useful when page refreshes or user visits directly)
    supabase.auth.getSession().then(({ data: { session } }) => {
      // If session exists → user is logged in
      setIsLoggedIn(!!session);
    });

    // 2. Listen for login/logout events in real time
    const { data: listener } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        // Update login state whenever auth changes
        setIsLoggedIn(!!session);
      }
    );

    // Cleanup: remove listener when component is destroyed
    return () => listener.subscription.unsubscribe();
  }, []); // [] means run only once when component loads

  // Function to log out the user
  const handleLogout = async () => {
    // Ask supabase to sign out
    await supabase.auth.signOut();
    // Redirect user back to home page
    navigate("/");
  };

  // JSX returned by the component (what shows on screen)
  return (
    <nav className="navbar"> {/* Navigation bar wrapper */}
      <div className="container"> {/* Centers content */}
        
        {/* Logo that links to home page */}
        <NavLink to="/" className="logo">MyWebsite</NavLink>

        {/* Navigation links list */}
        <ul className="nav-links">
          
          {/* Always show Home and About links */}
          <li><NavLink to="/">Home</NavLink></li>
          <li><NavLink to="/about">About</NavLink></li>

          {/* If user is NOT logged in → show Login link */}
          {!isLoggedIn && (
            <li><NavLink to="/login">Login</NavLink></li>
          )}

          {/* If user IS logged in → show Dashboard + Logout button */}
          {isLoggedIn && (
            <>
              <li><NavLink to="/dashboard">Dashboard</NavLink></li>
              <li>
                {/* Logout button calls handleLogout when clicked */}
                <button onClick={handleLogout} className="logout-btn">
                  Logout
                </button>
              </li>
            </>
          )}
        </ul>
      </div>
    </nav>
  );
}
```

---

### :brain: Code Breakdown

| Code Section                 | What It Does                                                        |
| ---------------------------- | ------------------------------------------------------------------- |
| `useState(false)`            | Starts assuming user is **not logged in**                           |
| `supabase.auth.getSession()` | Checks whether user already has a valid session (e.g. page refresh) |
| `onAuthStateChange()`        | Reacts instantly if login/logout happens anywhere in app            |
| `!!session`                  | Converts session object to `true`/`false`                           |
| `handleLogout()`             | Calls Supabase to clear auth token, then redirects                  |
| Conditional JSX              | Shows different menu items depending on login state                 |

---

## :white_check_mark: 2. Add CSS for Logout Button (Optional)

- Add this at bottom of **App.css** so the Logout button matches the nav links:

```css
/* Logout link styled like <a> elements */
.logout-btn {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 1rem;
}

.logout-btn:hover {
  color: #FFD700;
}
```

---

## :pushpin: Optional Redirect Variant

Current behaviour after logout is to redirect to **Home page**:

```ts
navigate("/");
```

If you want to redirect to **Login page instead**, change it to:

```ts
navigate("/login");
```

:information_source: This shows how UX choices change routing behaviour.

---

## ![Alert](./assets/Police_Flashing_Lights_10.gif) Important Clarification ![Alert](./assets/Police_Flashing_Lights_10.gif)

### :warning: “Showing/Removing Links” is **NOT** Security

Right now:

* A logged-out user **cannot see** the Dashboard link :white_check_mark:
* But they *can still type* `/dashboard` manually in the browser :x:
* There is **no protection yet** — only UI hiding :warning:

:eyes: **In Part 5 Protected Routes** is when we prevent access **even if someone manually types the URL**.

<mark>**Front-end visibility ≠ Security.** </mark>

<mark> **Authentication + Route Guards + RLS = Real Protection.**</mark>

---

## :test_tube: Testing Checklist

| Test                                           | Expected Result                                              |
| ---------------------------------------------- | ------------------------------------------------------------ |
| Visit site logged out                          | Navbar shows **Home / About / Login**  on the Menu           |
| Login with Supabase user                       | Navbar immediately changes, now shows **Dashboard + Logout** |
| Click Logout                                   | User is signed out, redirected to `/`                   |
| Refresh page while logged in                   | Navbar still shows Dashboard + Logout                        |
| Refresh after logout                           | Navbar resets to Login state                                 |
| Type `/dashboard` manually (currently allowed) | :white_check_mark: Works for now — will be locked in Part 5                   |

---

## :fast_forward: Next Step

**Part 5 – Protected Routes + Supabase Row Level Security (RLS)**

:heavy_check_mark: Prevent access when user is not logged in <br/>
:heavy_check_mark: Only `is_admin = true` users can manage other users <br/>
:heavy_check_mark: Add actual Supabase RLS policies <br/>

---

[Back](./04-Login_Using_Supabase_Auth.md) -- [Next](./05-Protected_Routes.md)